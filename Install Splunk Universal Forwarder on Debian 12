---
- name: Install Splunk Universal Forwarder on Debian 12
  hosts: all
  become: yes

  vars:
    splunk_version: "9.1.2"  # Replace with the desired Splunk version

  tasks:
    - name: Download Splunk Universal Forwarder
      ansible.builtin.get_url:
        url: "https://download.splunk.com/products/universalforwarder/releases/9.1.2/linux/splunkforwarder-9.1.2-b6b9c8185839-Linux-x86_64.tgz"
        dest: "/tmp/splunkforwarder.tgz"

    - name: Extract Splunk Universal Forwarder
      ansible.builtin.unarchive:
        src: "/tmp/splunkforwarder.tgz"
        dest: "/opt/"

    - name: Configure Splunk Universal Forwarder
      ansible.builtin.copy:
        src: "inputs.conf"
        dest: "/opt/splunkforwarder/etc/system/local/"
        mode: "0644"
      notify:
        - Restart Splunk Forwarder

  handlers:
    - name: Restart Splunk Forwarder
      ansible.builtin.command:
        cmd: "/opt/splunkforwarder/bin/splunk restart"
