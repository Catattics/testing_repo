---
- name: Install Splunk Universal Forwarder on Debian 12
  hosts: all
  become: yes

  vars:
    splunk_version: "9.1.2"  # Replace with the desired Splunk version

  tasks:
    - name: Download Splunk Universal Forwarder
      ansible.builtin.get_url:
        url: "https://www.splunk.com/bin/splunk/DownloadActivityServlet?architecture=x86_64&platform=linux&version={{ splunk_version }}&product=universalforwarder&filename=splunkforwarder-{{ splunk_version }}-Linux-x86_64.tgz"
        dest: "/tmp/splunkforwarder.tgz"
      remote_src: yes

    - name: Extract Splunk Universal Forwarder
      ansible.builtin.unarchive:
        src: "/tmp/splunkforwarder.tgz"
        dest: "/opt/"

    - name: Download inputs.conf template
      get_url:
        url: "https://raw.githubusercontent.com/Catattics/testing_repo/main/inputs.conf"
        dest: /opt/splunkforwarder/etc/system/local/

    - name: Configure Splunk Universal Forwarder
      ansible.builtin.copy:
        src: "inputs.conf"
        dest: "/opt/splunkforwarder/etc/system/local/"
        mode: "0644"
      notify:
        - Restart Splunk Forwarder

  handlers:
    - name: Restart Splunk Forwarder
      ansible.builtin.command:
        cmd: "/opt/splunkforwarder/bin/splunk restart"
