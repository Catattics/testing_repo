---
- name: Install and configure Wazuh Agent on Debian 12
  hosts: your_target_host
  become: true

  tasks:
    - name: Download Wazuh Agent package
      get_url:
        url: https://packages.wazuh.com/4.x/apt/pool/main/w/wazuh-agent/wazuh-agent_4.6.0-1_amd64.deb
        dest: /tmp/wazuh-agent_4.6.0-1_amd64.deb

    - name: Install Wazuh Agent package
      command: dpkg -i /tmp/wazuh-agent_4.6.0-1_amd64.deb
      args:
        creates: /var/ossec/etc/preloaded-vars.conf  # This file is created after successful installation

    - name: Create /var/ossec/etc/ directory
      file:
        path: /var/ossec/etc
        state: directory

    - name: Create ossec.conf file
      copy:
        content: ""
        dest: /var/ossec/etc/ossec.conf

    - name: Set Wazuh Manager and Agent name
      lineinfile:
        path: /var/ossec/etc/ossec.conf
        line: "{{ item }}"
      loop:
        - "WAZUH_MANAGER='10.27.27.13'"
        - "WAZUH_AGENT_NAME='debian'"

    - name: Reload systemd
      systemd:
        daemon_reload: yes

    - name: Enable Wazuh Agent service
      systemd:
        name: wazuh-agent
        enabled: yes
        state: started
